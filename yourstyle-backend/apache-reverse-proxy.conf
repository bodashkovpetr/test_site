# Apache Reverse Proxy Configuration for YourStyle Backend
# Place this file in: C:\xampp\apache\conf\extra\ (Windows/XAMPP)
# Then include it in httpd.conf with: Include conf/extra/apache-reverse-proxy.conf

# Enable required modules (uncomment in httpd.conf if not already enabled):
# LoadModule proxy_module modules/mod_proxy.so
# LoadModule proxy_http_module modules/mod_proxy_http.so
# LoadModule headers_module modules/mod_headers.so

<VirtualHost *:80>
    ServerName yourstyle.space
    ServerAlias www.yourstyle.space plitka.live www.plitka.live

    DocumentRoot "C:/xampp/htdocs/yourstyle"
    
    # Enable directory listing (optional)
    <Directory "C:/xampp/htdocs/yourstyle">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Proxy API requests to Node.js backend
    ProxyPreserveHost On
    ProxyTimeout 300
    
    # Proxy /api requests to backend
    <Location /api>
        ProxyPass http://localhost:3000/api
        ProxyPassReverse http://localhost:3000/api
        
        # CORS headers (if backend doesn't handle them)
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    </Location>

    # Handle preflight OPTIONS requests
    <LocationMatch "/api/*">
        <If "%{REQUEST_METHOD} == 'OPTIONS'">
            Header always set Access-Control-Allow-Origin "*"
            Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
            Header always set Access-Control-Max-Age "3600"
        </If>
    </LocationMatch>

    # Logging
    ErrorLog "logs/yourstyle-error.log"
    CustomLog "logs/yourstyle-access.log" combined
</VirtualHost>

# SSL Configuration (when SSL certificate is configured)
<VirtualHost *:443>
    ServerName yourstyle.space
    ServerAlias www.yourstyle.space plitka.live www.plitka.live

    DocumentRoot "C:/xampp/htdocs/yourstyle"
    
    <Directory "C:/xampp/htdocs/yourstyle">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile "C:/xampp/apache/conf/ssl.crt/yourstyle.crt"
    SSLCertificateKeyFile "C:/xampp/apache/conf/ssl.key/yourstyle.key"
    SSLCertificateChainFile "C:/xampp/apache/conf/ssl.crt/yourstyle-chain.crt"

    # Proxy API requests to Node.js backend
    ProxyPreserveHost On
    ProxyTimeout 300
    
    <Location /api>
        ProxyPass http://localhost:3000/api
        ProxyPassReverse http://localhost:3000/api
        
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    </Location>

    <LocationMatch "/api/*">
        <If "%{REQUEST_METHOD} == 'OPTIONS'">
            Header always set Access-Control-Allow-Origin "*"
            Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
            Header always set Access-Control-Max-Age "3600"
        </If>
    </LocationMatch>

    # Logging
    ErrorLog "logs/yourstyle-ssl-error.log"
    CustomLog "logs/yourstyle-ssl-access.log" combined
</VirtualHost>
